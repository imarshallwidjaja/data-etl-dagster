{% extends "base.html" %}

{% block title %}Lineage: {{ asset.dataset_id }} - Data ETL Tooling{% endblock %}

{% block content %}
<article>
    <header>
        <hgroup>
            <h1>ğŸ”— Lineage: {{ asset.dataset_id }}</h1>
            <p>View parent assets and transformations.</p>
        </hgroup>
    </header>

    <p><a href="/assets/{{ asset.dataset_id }}" role="button" class="secondary outline">â† Back to Asset</a></p>

    <!-- Current Asset -->
    <h2>Target Asset</h2>
    <figure>
        <table>
            <tbody>
                <tr>
                    <td><strong>Dataset ID</strong></td>
                    <td><code>{{ asset.dataset_id }}</code></td>
                </tr>
                <tr>
                    <td><strong>Version</strong></td>
                    <td>v{{ asset.version }}</td>
                </tr>
                <tr>
                    <td><strong>Kind</strong></td>
                    <td>{{ asset.kind }}</td>
                </tr>
                <tr>
                    <td><strong>S3 Key</strong></td>
                    <td><code>{{ asset.s3_key }}</code></td>
                </tr>
            </tbody>
        </table>
    </figure>

    <!-- Parent Assets -->
    <h2>Parent Assets ({{ parents|length }})</h2>

    {% if parents %}
    <div class="lineage-graph">
        {% for p in parents %}
        <article class="lineage-node">
            <header>
                <h4>{{ p.dataset_id }}</h4>
            </header>
            <p>
                <strong>Version:</strong> v{{ p.version }}<br>
                <strong>Kind:</strong> {{ p.kind }}<br>
                <strong>Transformation:</strong> <code>{{ p.transformation }}</code>
            </p>
            <footer>
                <a href="/assets/{{ p.dataset_id }}" role="button" class="outline"
                    style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">View</a>
            </footer>
        </article>
        {% endfor %}
    </div>

    <!-- Lineage Diagram -->
    <h3>Lineage Visualization</h3>
    <div class="lineage-diagram">
        <div class="lineage-parents">
            {% for p in parents %}
            <div class="lineage-parent-box">
                ğŸ“¦ {{ p.dataset_id }}<br>
                <small>({{ p.kind }} v{{ p.version }})</small>
            </div>
            {% endfor %}
        </div>
        <div class="lineage-arrow">â†“</div>
        <div class="lineage-target-box">
            â¬‡ï¸ {{ parents[0].transformation if parents else 'transform' }}<br>
            ğŸ“¦ <strong>{{ asset.dataset_id }}</strong><br>
            <small>({{ asset.kind }} v{{ asset.version }})</small>
        </div>
    </div>
    {% else %}
    <p><em>No parent assets found. This asset has no lineage (it may be a source asset).</em></p>
    {% endif %}
</article>

<style>
    .lineage-graph {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
    }

    .lineage-node {
        margin: 0;
    }

    .lineage-diagram {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 2rem 0;
        padding: 1rem;
        background: var(--pico-card-background-color);
        border-radius: var(--pico-border-radius);
    }

    .lineage-parents {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
    }

    .lineage-parent-box,
    .lineage-target-box {
        padding: 1rem;
        background: var(--pico-background-color);
        border: 2px solid var(--pico-muted-border-color);
        border-radius: var(--pico-border-radius);
        text-align: center;
    }

    .lineage-target-box {
        border-color: var(--pico-primary);
        margin-top: 0.5rem;
    }

    .lineage-arrow {
        font-size: 2rem;
        margin: 0.5rem 0;
        color: var(--pico-muted-color);
    }
</style>
{% endblock %}